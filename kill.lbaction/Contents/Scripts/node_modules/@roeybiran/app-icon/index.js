"use strict";

const path = require("path");
const plist = require("simple-plist");
const util = require("util");

const readPlistAsync = util.promisify(plist.readFile);

/**
 * Asynchronously returns the path to an application's icon. If the icon couldn't be find,
 * return the generic macOS icon for applications.
 * @param {String} appPath - the path to the .app package.
 * @returns {String} the application's path.
 */
module.exports = async appPath => {
  const fullPath = path.join(appPath, "/Contents/Info.plist");
  let icon = await readPlistAsync(fullPath);
  icon = icon.CFBundleIconFile;
  if (icon) {
    icon = icon.endsWith(".icns") ? icon : `${icon}.icns`;
    return path.join(appPath, "/Contents/Resources/", icon);
  }
  return undefined;
};
